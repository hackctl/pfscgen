document.addEventListener("DOMContentLoaded",function(){console.log("DOM loaded, initializing PFSCGen...");let e=0;const t=document.getElementById("groups"),o=document.getElementById("groupTemplate"),n=document.getElementById("targetTemplate"),l=document.getElementById("labelTemplate"),r=document.getElementById("yamlOutput");function c(e,t="",o=""){console.log("Adding key-value pair:",t,o);const n=l.content.cloneNode(!0),r=n.querySelector(".label-key"),c=n.querySelector(".label-value"),a=n.querySelector(".remove-label"),u=n.querySelector(".kv-row");r.value=t,c.value=o,a.addEventListener("click",function(e){console.log("Removing label row"),e.preventDefault(),u.remove(),d()}),r.addEventListener("input",d),c.addEventListener("input",d),e.appendChild(n)}function a(e,t=""){console.log("Adding target:",t);const o=n.content.cloneNode(!0),l=o.querySelector(".target-input"),r=o.querySelector(".remove-target"),c=o.querySelector(".kv-row");l.value=t,r.addEventListener("click",function(e){console.log("Removing target row"),e.preventDefault(),c.remove(),d()}),l.addEventListener("input",d),e.appendChild(o)}function u(n=null){console.log("Adding group:",n);const l=o.content.cloneNode(!0).querySelector(".group-wrapper");e++;const r=l.querySelector(".group-name");r.id="group-name-"+e,n&&(r.value=n.name||"");const u=l.querySelector(".group-targets");(n&&n.targets?n.targets:[""]).forEach(e=>a(u,e)),l.querySelector(".add-target").addEventListener("click",function(e){console.log("Add target button clicked"),e.preventDefault(),a(u)});const i=l.querySelector(".group-labels");(n&&n.labels?Object.entries(n.labels):[["",""]]).forEach(([e,t])=>c(i,e,t)),l.querySelector(".add-group-label").addEventListener("click",function(e){console.log("Add label button clicked"),e.preventDefault(),c(i)});const s=l.querySelector(".chevron-btn"),g=s.querySelector("i"),p=l.querySelector(".group-card"),m=l.querySelector(".group-title");function v(){m.textContent=r.value||"Unnamed Group"}r.addEventListener("input",function(){v(),d()}),v(),s.addEventListener("click",function(e){console.log("Chevron button clicked"),e.preventDefault(),p.classList.toggle("collapsed"),g.classList.toggle("bi-chevron-down"),g.classList.toggle("bi-chevron-right"),v()}),l.querySelector(".remove-group").addEventListener("click",function(e){console.log("Remove group button clicked"),e.preventDefault(),l.remove(),d()}),t.appendChild(l),d()}function d(){console.log("Updating JSON configuration...");const e=[];if(document.querySelectorAll(".group-wrapper").forEach(t=>{const o=[],n={};t.querySelectorAll(".target-input").forEach(e=>{o.push(e.value.trim())}),t.querySelectorAll(".label-key").forEach((e,o)=>{const l=t.querySelectorAll(".label-value")[o];(e.value.trim()||l.value.trim())&&(n[e.value.trim()||"key"]=l.value.trim()||"value")}),e.push({targets:o,labels:n})}),console.log("Collected groups:",e),0!==e.length)try{const t=function(e){if(!e||0===e.length)return"[]";const t=e.map(e=>{const t={targets:[]};return e.targets&&e.targets.length>0&&e.targets.forEach(e=>{e.trim()&&t.targets.push(e.trim())}),e.labels&&Object.keys(e.labels).length>0&&(t.labels={},Object.entries(e.labels).forEach(([e,o])=>{e.trim()&&o.trim()&&(t.labels[e.trim()]=o.trim())})),t});return JSON.stringify(t,null,2)}(e);r.textContent=t}catch(e){console.error("Error generating configuration:",e),r.textContent=`// Error: ${e.message}`}else r.textContent="// Please add at least one group..."}console.log("Elements found:",{groupsDiv:!!t,groupTemplate:!!o,targetTemplate:!!n,labelTemplate:!!l,yamlOutput:!!r});const i=document.getElementById("addGroupBtn");i?(console.log("Add group button found, adding event listener"),i.addEventListener("click",function(e){console.log("Add group button clicked"),e.preventDefault(),u(),d()})):console.error("Add group button not found!");const s=document.getElementById("downloadConfigBtn");s?(console.log("Download button found, adding event listener"),s.addEventListener("click",function(e){console.log("Download button clicked"),e.preventDefault();const t=r.textContent;if(t.startsWith("// Error:")||t.startsWith("// Please add")||"[]"===t)return void console.log("No valid content to download");const o=new Blob([t],{type:"application/json"}),n=URL.createObjectURL(o),l=document.createElement("a");l.href=n,l.download="prometheus-file-sd-config.json",document.body.appendChild(l),l.click(),setTimeout(()=>{document.body.removeChild(l),URL.revokeObjectURL(n)},0)})):console.error("Download button not found!"),console.log("Adding default example group"),u({name:"node-exporter",targets:["localhost:9100","server1:9100"],labels:{job:"node-exporter",env:"production"}})});